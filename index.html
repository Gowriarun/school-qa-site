<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>St. Mary‚Äôs Parent Assistant</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f1222;           /* deep indigo bg */
      --panel:#141833;        /* chat surface */
      --muted:#a9b1d6;
      --text:#e9edff;
      --bubble:#1b2250;       /* bot bubble */
      --me:#2b377f;           /* my bubble */
      --accent:#6ea8ff;       /* buttons/links */
      --border:rgba(255,255,255,.08);
      --ring:rgba(110,168,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 900px at 80% -10%, #1d2555 0%, #111432 45%, #0f1222 100%);
      font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* shell */
    .wrap{
      min-height:100%;
      display:flex; align-items:center; justify-content:center;
      padding:16px;
    }
    .card{
      width:min(960px,100%);
      height:min(82vh,820px);
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.02)) , var(--panel);
      border:1px solid var(--border); border-radius:20px;
      box-shadow:0 30px 80px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset;
      display:grid; grid-template-rows:auto 1fr auto; overflow:hidden;
    }

    /* top bar */
    header{
      display:flex; align-items:center; gap:12px;
      padding:14px 16px; border-bottom:1px solid var(--border);
      background:linear-gradient(180deg,rgba(255,255,255,.04),transparent);
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:600; letter-spacing:.3px;
    }
    .logo{
      height:28px; width:28px; border-radius:8px;
      background:linear-gradient(135deg,#6ea8ff,#a28bff); box-shadow:0 0 0 4px rgba(110,168,255,.12);
      display:inline-block;
    }
    .sub{margin-left:auto;color:var(--muted); font-size:12px}

    /* chat */
    .chat{
      position:relative; overflow:auto; padding:18px; display:flex; flex-direction:column; gap:12px;
      scroll-behavior:smooth; background:
        radial-gradient(600px 260px at 10% -10%, rgba(110,168,255,.08), transparent 70%),
        radial-gradient(600px 260px at 110% 10%, rgba(162,139,255,.08), transparent 70%);
    }
    .bubble{
      max-width:min(78ch, 86%);
      padding:12px 14px; border-radius:16px; line-height:1.55; font-size:15px;
      border:1px solid var(--border); background:var(--bubble);
      box-shadow:0 6px 24px rgba(0,0,0,.18);
    }
    .me{ margin-left:auto; background:var(--me) }
    .bot{ margin-right:auto }
    .hint{ color:var(--muted); font-size:12px; margin-top:4px }
    .typing{ display:inline-flex; gap:6px; align-items:center }
    .dot{ width:6px; height:6px; border-radius:50%; background:#c9d5ff; opacity:.6; animation:blink 1.3s infinite }
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    @keyframes blink { 0%,80%,100%{opacity:.2} 30%{opacity:.9} }

    /* dock */
    .dock{
      padding:12px; border-top:1px solid var(--border); background:linear-gradient(0deg,rgba(255,255,255,.03),transparent);
      display:grid; gap:10px;
    }
    .chips{ display:flex; gap:8px; flex-wrap:wrap }
    .chip{
      background:transparent; border:1px solid var(--border); color:var(--muted);
      padding:8px 10px; border-radius:999px; font-size:12px; cursor:pointer;
    }
    .chip:hover{ border-color:#8fb7ff33; color:#d9e4ff; box-shadow:0 0 0 4px var(--ring) }

    .form{ display:flex; gap:10px }
    input[type="text"]{
      flex:1; padding:14px 14px; border-radius:12px; border:1px solid var(--border);
      background:#0f1330; color:var(--text); outline:none; font-size:15px;
    }
    input[type="text"]::placeholder{color:#9aa3cf}
    input[type="text"]:focus{ box-shadow:0 0 0 4px var(--ring); border-color:#8fb7ff33 }
    button.send{
      padding:0 16px; border-radius:12px; border:1px solid #7aa7ff55; color:#0d122e;
      background:linear-gradient(135deg,#6ea8ff,#a28bff); font-weight:700;
      display:inline-flex; align-items:center; gap:8px; cursor:pointer;
      box-shadow:0 10px 26px rgba(110,168,255,.35);
    }
    button.send:disabled{opacity:.5; cursor:not-allowed}

    /* mobile */
    @media (max-width:720px){
      .card{ height:calc(100vh - 24px) }
      .bubble{ max-width:92% }
      header{ padding:12px }
      .chat{ padding:14px }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="St. Mary‚Äôs Parent Assistant chat">
      <header>
        <span class="logo" aria-hidden="true"></span>
        <div class="brand">St. Mary‚Äôs Parent Assistant</div>
        <div class="sub">Ask about admissions ‚Ä¢ fees ‚Ä¢ subjects</div>
      </header>

      <main id="chat" class="chat" tabindex="0" aria-live="polite">
        <!-- initial greeting -->
        <div class="bubble bot">
          Hi! I‚Äôm the St. Mary‚Äôs Parent Assistant üòä<br/>
          Ask me anything about <b>admissions</b>, <b>fees</b>, <b>subjects</b>, documents, curriculum, or policies.
          <div class="hint">Try: ‚ÄúDocuments for admission‚Äù, ‚ÄúFees for Grade 11‚Äù, ‚ÄúA‚Äô Level subjects‚Äù.</div>
        </div>
      </main>

      <div class="dock">
        <div class="chips" id="chips">
          <button class="chip" data-q="What documents are required for admissions?">Documents</button>
          <button class="chip" data-q="Fees for Grade 11">Fees (G11)</button>
          <button class="chip" data-q="Admission for Grade 11">Admission G11</button>
          <button class="chip" data-q="Grade 9 subjects choices">Grade 9 subjects</button>
          <button class="chip" data-q="A‚Äô Level subjects">A‚Äô Level</button>
        </div>

        <form id="form" class="form" autocomplete="off">
          <input id="q" type="text" placeholder="Type your question‚Ä¶" required />
          <button id="send" class="send" type="submit" aria-label="Send message">Send ‚Üó</button>
        </form>
      </div>
    </div>
  </div>

  <!-- üîß Worker endpoint -->
  <script>
    const WORKER_URL = "https://delicate-cake-3610.gowriarunn2008.workers.dev/api/ask"; // ‚Üê change if yours differs
  </script>

  <!-- üìö Knowledge Base (same as we built earlier, trimmed comments) -->
  <script id="kb" type="application/json">
  {
    "school": {
      "name": "St. Mary‚Äôs Catholic High School, Fujairah",
      "location": "Fujairah, UAE",
      "motto": "The End Crowns the Work",
      "leadership": {
        "sponsor": "H.E. Dr. Mohamed Saeed Al Kindi",
        "owner": "His Excellency Bishop Paolo Martinelli",
        "managing_director": "Mr. Joseph Flynn",
        "principal": "Fr. Suresh Kumar SDB"
      }
    },
    "vision": "To prepare innovative global leaders and realize the National Agenda by providing holistic, inclusive, quality and sustainable education.",
    "mission": [
      "Ensure academic excellence via continuous assessment, research, innovation and discovery.",
      "Respect UAE culture and values.",
      "Value-based learning delivered by committed, qualified staff.",
      "Cater to differing abilities via competency-based teaching.",
      "Humanitarian values and responsibility.",
      "Strong parent & stakeholder collaboration."
    ],
    "admissions": {
      "kg_age_rule": "KG1/KG2 applicants must be four years old on/before August 31 for September start.",
      "grade_tests": "Grades 1‚Äì9 admission is based on an entrance test (English & Mathematics ~1 hour each). Admission is competitive when applicants exceed seats.",
      "no_grade10": "No new admissions to Grade 10 as students prepare for London Board exams.",
      "grade11": "Enrollment starts in August after O‚Äô/Grade 10 results. For UK curriculum students who passed Board Exams with minimum A*/A (9‚Äì7).",
      "grade12": "Admission to Grade 12 (IAL) is for students who completed IAS with minimum grades A and B.",
      "a_level_enrollment": "Eligible students: Completed O‚ÄôLevel/Grade 10 with six subjects including English and Math and secure Grade A in chosen A‚Äô subjects.",
      "results_contact": "Only selected applicants will be contacted with registration details.",
      "subject_change_policy": "Once choices are made, subjects cannot be changed during the year unless the school contacts parents for adjustments.",
      "docs_required": [
        "Child‚Äôs passport + visa page",
        "Birth certificate",
        "Vaccination card (KG1/2 & Grade 1)",
        "Emirates ID",
        "Six passport photos",
        "Latest report card + reference letter from previous school",
        "Attested Transfer/School Leaving Certificate",
        "Bonafide certificate (Grade 1‚Äì8)",
        "Medical record book",
        "Family book (UAE nationals only)"
      ],
      "transfer_notes": [
        "Within UAE: attest certificates at the MoE in the concerned Educational Zone.",
        "From abroad: attest at (1) Regional Education Office, (2) country‚Äôs Embassy/Consulate in UAE, (3) UAE Ministry of Foreign Affairs."
      ]
    },
    "fees_per_year_aed": {
      "KG1-2": 7270,
      "G1-3": 8100,
      "G4-6": 9100,
      "G7-8": 11200,
      "G9-10": 13100,
      "G11-12_Alevel": 15900,
      "installments_note": "Paid in three installments as per official schedule."
    },
    "curriculum": {
      "board": "UK British Curriculum; Pearson Edexcel centre.",
      "stages": ["EYFS","Gr2‚Äì5 International Primary","Gr6‚Äì8 KS3 Lower Secondary","Gr9‚Äì10 GCSE/IGCSE","Gr11 IAS","Gr12 IAL"],
      "medium": "English",
      "arabic_islamic": "Arabic mandatory G1‚Äì9 (and for Arabs until G12). Islamic Studies compulsory for Muslim students G1‚Äì12.",
      "secondary_notes": [
        "From G9 students prepare for IGCSE/GCSE and later IAS/IAL.",
        "Subject concentration (science or arts/commerce) begins G9, finalized end of G8."
      ]
    },
    "subjects": {
      "grade9_minimum": "Minimum 9 subjects in Grade 9.",
      "gcse_compulsory": [
        "English Language (IGCSE)",
        "Religious/Islamic Studies (per MoE)",
        "Social Studies (until G9)",
        "Mathematics (IGCSE)",
        "Higher/Lower Arabic",
        "MEP (Arabic/English) compulsory until G12 (Arabic compulsory for Arabs until G12; Arabic board exam available as GCSE)"
      ],
      "gcse_optional": [
        "English Literature (IGCSE)",
        "ICT (IGCSE)",
        "Global Citizenship (IGCSE) or Urdu (GCSE)"
      ],
      "pairs": ["Chemistry or Accounts","Physics or Economics","Biology or Business Studies"],
      "rules": [
        "After selection, subjects cannot be changed/dropped.",
        "Choose according to university and destination country.",
        "Classes depend on sufficient demand."
      ],
      "a_level": [
        "Math","Physics or Economics","Chemistry or Accounts","Biology or Business Studies",
        "Islam (English or Arabic)","Higher/Lower Arabic"
      ],
      "a_level_rules": [
        "Choose at least two A‚Äô Level subjects (excluding Arabic & Islamic).",
        "For higher education in UAE: Arabic mandatory for all; Islamic mandatory for Muslims (MoE unified exams)."
      ]
    },
    "equivalency_uae": [
      "Complete Grade 12 (or equivalent).",
      "Pass five O-level subjects (IGCSE/GCSE) grades A*‚ÄìD (9‚Äì3), including Math; one science; English Language/Literature.",
      "Pass two A-level/IAS/IAL subjects grades A*‚ÄìE.",
      "Arabic & Islamic (O‚Äô and A‚Äô) are not counted among required subjects."
    ],
    "policies": {
      "attendance": ["Regular attendance; follow timings.","Absences need valid reason/medical note.","Excess absence may affect promotion/exam eligibility."],
      "assessment_examination": ["Continuous assessment + formal exams per Edexcel & MoE.","Academic honesty required."],
      "homework": ["Homework reinforces learning; submit on time.","Parents should support routines."],
      "promotion_retention": ["Promotion considers performance, assessments, attendance, conduct.","Remedials may be advised before retention."],
      "uniform_discipline": ["Wear full uniform; neat appearance.","Respectful behavior; misconduct leads to disciplinary action."],
      "transport": ["Transport on set routes; seats subject to availability.","Follow bus safety rules."],
      "health_safety": ["Share medical conditions; keep vaccinations updated.","Sick students should stay home; report contagious conditions."]
    },
    "contact": { "note": "For anything not covered, please contact the school office." }
  }
  </script>

  <!-- üß† App -->
  <script>
  const chat = document.getElementById('chat');
  const form = document.getElementById('form');
  const input = document.getElementById('q');
  const chips = document.getElementById('chips');
  const KB = document.getElementById('kb').textContent;

  function addBubble(text, me=false){
    const b=document.createElement('div');
    b.className='bubble ' + (me?'me':'bot');
    b.innerHTML = text.replace(/\n/g,'<br>');
    chat.appendChild(b);
    chat.scrollTop = chat.scrollHeight;
    return b;
  }
  let typingEl=null;
  function showTyping(){
    typingEl=document.createElement('div');
    typingEl.className='bubble bot';
    typingEl.innerHTML=`<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
    chat.appendChild(typingEl);
    chat.scrollTop=chat.scrollHeight;
  }
  function hideTyping(){
    if(typingEl){ typingEl.remove(); typingEl=null; }
  }

  async function ask(q){
    // optimistic render
    addBubble(q, true);
    input.value='';
    input.focus();

    // call worker
    try{
      showTyping();
      const res = await fetch(WORKER_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ question:q, kb:KB })
      });
      hideTyping();
      if(!res.ok){
        addBubble("Sorry, I couldn‚Äôt reach the service. Please try again.", false);
        return;
      }
      const data = await res.json();
      addBubble(data.answer || "Sorry, I don‚Äôt have that in the official info.", false);
    }catch(e){
      hideTyping();
      addBubble("Network error. Please check your connection and try again.", false);
    }
  }

  // submit
  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const q=input.value.trim();
    if(!q) return;
    ask(q);
  });

  // chips
  chips.addEventListener('click', (e)=>{
    const btn=e.target.closest('[data-q]');
    if(!btn) return;
    ask(btn.dataset.q);
  });

  // greet focus
  setTimeout(()=> input.focus(), 250);
  </script>
</body>
</html>
