<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>St. Mary‚Äôs Parent Assistant</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg:#0e1222; --panel:#141833; --muted:#a9b1d6; --text:#e9edff;
      --bubble:#18204a; --me:#2a377f; --accent:#6ea8ff; --border:rgba(255,255,255,.08);
      --ring:rgba(110,168,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:
      radial-gradient(1200px 900px at 80% -10%, #1b2352 0%, #111433 45%, #0e1222 100%);
      font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{
      width:min(1000px,100%); height:min(84vh,880px);
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.02)),var(--panel);
      border:1px solid var(--border); border-radius:20px; overflow:hidden;
      display:grid; grid-template-rows:auto 1fr auto;
      box-shadow:0 30px 80px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset;
    }
    header{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);
      background:linear-gradient(180deg,rgba(255,255,255,.04),transparent)}
    .logo{height:28px;width:28px;border-radius:8px;background:linear-gradient(135deg,#6ea8ff,#a28bff);box-shadow:0 0 0 4px rgba(110,168,255,.12)}
    .brand{font-weight:600;letter-spacing:.3px}
    .sub{margin-left:auto;color:var(--muted);font-size:12px}

    .chat{position:relative;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth;background:
      radial-gradient(600px 260px at 10% -10%, rgba(110,168,255,.08), transparent 70%),
      radial-gradient(600px 260px at 110% 10%, rgba(162,139,255,.08), transparent 70%)}
    .bubble{max-width:min(78ch,86%);padding:12px 14px;border-radius:16px;line-height:1.55;font-size:15px;border:1px solid var(--border);
      background:var(--bubble);box-shadow:0 6px 24px rgba(0,0,0,.18)}
    .me{margin-left:auto;background:var(--me)}
    .bot{margin-right:auto}
    .hint{color:var(--muted);font-size:12px;margin-top:4px}
    .typing{display:inline-flex;gap:6px;align-items:center}
    .dot{width:6px;height:6px;border-radius:50%;background:#c9d5ff;opacity:.6;animation:blink 1.3s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    @keyframes blink{0%,80%,100%{opacity:.2}30%{opacity:.9}}

    .dock{padding:12px;border-top:1px solid var(--border);background:linear-gradient(0deg,rgba(255,255,255,.03),transparent);display:grid;gap:10px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:transparent;border:1px solid var(--border);color:var(--muted);padding:8px 10px;border-radius:999px;font-size:12px;cursor:pointer}
    .chip:hover{border-color:#8fb7ff33;color:#d9e4ff;box-shadow:0 0 0 4px var(--ring)}
    .form{display:flex;gap:10px}
    input[type="text"]{flex:1;padding:14px;border-radius:12px;border:1px solid var(--border);background:#0f1330;color:var(--text);outline:none;font-size:15px}
    input[type="text"]::placeholder{color:#9aa3cf}
    input[type="text"]:focus{box-shadow:0 0 0 4px var(--ring);border-color:#8fb7ff33}
    button.send{padding:0 16px;border-radius:12px;border:1px solid #7aa7ff55;color:#0d122e;background:linear-gradient(135deg,#6ea8ff,#a28bff);
      font-weight:700;display:inline-flex;align-items:center;gap:8px;cursor:pointer;box-shadow:0 10px 26px rgba(110,168,255,.35)}
    button.send:disabled{opacity:.5;cursor:not-allowed}
    .sys{font-size:12px;color:#9fb3ff}
    @media (max-width:720px){.card{height:calc(100vh - 24px)}.bubble{max-width:92%}header{padding:12px}.chat{padding:14px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="St. Mary‚Äôs Parent Assistant">
      <header>
        <span class="logo" aria-hidden="true"></span>
        <div class="brand">St. Mary‚Äôs Parent Assistant</div>
        <div class="sub">Admissions ‚Ä¢ Fees ‚Ä¢ Subjects ‚Ä¢ Policies</div>
      </header>

      <main id="chat" class="chat" tabindex="0" aria-live="polite">
        <div class="bubble bot">
          Hi! I‚Äôm the St. Mary‚Äôs Parent Assistant üòä<br/>
          Ask me about <b>admissions</b>, <b>fees</b>, <b>subjects</b>, documents, timings, or policies.
          <div class="hint">Try: ‚ÄúDocuments for admission‚Äù, ‚ÄúFees for Grade 11‚Äù, ‚ÄúA‚Äô Level subjects‚Äù, ‚ÄúSchool timings‚Äù, ‚ÄúParent portal‚Äù.</div>
        </div>
      </main>

      <div class="dock">
        <div class="chips" id="chips">
          <button class="chip" data-q="What documents are required for admissions?">Documents</button>
          <button class="chip" data-q="Fees for Grade 11">Fees (G11)</button>
          <button class="chip" data-q="What are the school timings?">School timings</button>
          <button class="chip" data-q="Who is the principal?">Principal</button>
          <button class="chip" data-q="Where do I buy the uniform?">Uniform</button>
          <button class="chip" data-q="Parent portal login">Parent portal</button>
          <button class="chip" data-q="Subjects for Grade 9">Subjects for Grade 9</button>
          <button class="chip" data-q="A level subjects">A‚Äô Level subjects</button>
        </div>
        <form id="form" class="form" autocomplete="off">
          <input id="q" type="text" placeholder="Type your question‚Ä¶" required />
          <button id="send" class="send" type="submit" aria-label="Send">Send ‚Üó</button>
        </form>
        <div class="sys" id="sys"></div>
      </div>
    </div>
  </div>

  <!-- Your Worker URL -->
  <script>
    // ‚ö†Ô∏è Set this to your Worker route
    const WORKER_URL = "https://delicate-cake-3610.gowriarunn2008.workers.dev/api/ask";
  </script>

  <!-- Knowledge Base (curated) -->
  <script id="kb" type="application/json">
{
  "school": {
    "name": "St. Mary‚Äôs Catholic High School, Fujairah",
    "location": "Fujairah, UAE",
    "motto": "The End Crowns the Work",
    "leadership": {
      "sponsor": "H.E. Dr. Mohamed Saeed Al Kindi",
      "owner": "His Excellency Bishop Paolo Martinelli",
      "managing_director": "Mr. Joseph Flynn",
      "principal": "Fr. Suresh Kumar SDB"
    }
  },
  "contact": {
    "postal_address": "St. Mary‚Äôs Catholic High School, P.O. Box: 1665, Fujairah, UAE",
    "phone": "09-2282828",
    "fax": "09-2281910",
    "email": "secretary.principal-smf@smgeducation.org"
  },
  "timings": {
    "monday_thursday": "07:40 AM ‚Äì 02:05 PM",
    "friday": "07:25 AM ‚Äì 11:20 AM",
    "weekend": "Closed (Sat‚ÄìSun)"
  },
  "admissions": {
    "apply": "Visit campus and speak to the Admissions Coordinator/reception; or contact the admissions officer.",
    "kg_age_rule": "KG1/KG2 applicants must be 4 years old on or before Aug 31 for September intake.",
    "grade_tests": "Grades 1‚Äì9: entrance tests in English & Mathematics (~1 hour each). Competitive if applicants exceed seats.",
    "no_grade10": "No new admissions to Grade 10 (students prepare for London Board exams).",
    "grade11": "Enroll in August after O‚Äô/Grade 10 results. For UK-curriculum students with board passes (typ. min A*/A=9‚Äì7).",
    "a_level_enrollment": "A‚Äô Level: O‚ÄôLevel/Grade 10 with six subjects incl. English & Math and Grade A in chosen A‚Äô subjects.",
    "grade12": "Grade 12 (IAL) requires IAS completed with minimum A & B in board exam.",
    "subject_change_policy": "Once choices are made, subjects generally cannot be changed during the year.",
    "docs_required": [
      "Child‚Äôs passport + visa page",
      "Birth certificate",
      "Vaccination card (KG1/2 & Gr.1)",
      "Emirates ID",
      "Six passport photos",
      "Latest report card + reference letter",
      "Attested Transfer/School Leaving Certificate",
      "Bonafide certificate (Grade 1‚Äì8)",
      "Medical record book",
      "Family book (UAE nationals only)"
    ],
    "transfer_notes": [
      "Within UAE: attest certificates at MoE in concerned Educational Zone.",
      "From abroad: attest at Regional Education Office, your country‚Äôs Embassy/Consulate in UAE, and UAE MOFA."
    ]
  },
  "fees_per_year_aed": {
    "KG1-2": 7270,
    "G1-3": 8100,
    "G4-6": 9100,
    "G7-8": 11200,
    "G9-10": 13100,
    "G11-12_Alevel": 15900,
    "installments_note": "Fees are paid in three installments."
  },
  "payments": {
    "methods": "Payments must be made at school (confirm cash/cheque/bank options with Accounts).",
    "late_penalties": "Late penalties may apply (confirm with Accounts).",
    "sibling_discount": "Check with Accounts for current sibling discount policy.",
    "reregistration": "Re-registration fee required for returning students (dates announced by office)."
  },
  "curriculum": {
    "board": "UK British Curriculum; Pearson Edexcel examination centre.",
    "stages": ["EYFS","Gr2‚Äì5 International Primary","Gr6‚Äì8 KS3 Lower Secondary","Gr9‚Äì10 GCSE/IGCSE","Gr11 IAS","Gr12 IAL"],
    "medium": "English",
    "arabic_islamic": "Arabic is mandatory Gr1‚Äì9 (compulsory for Arabs through Gr12). Islamic Studies is compulsory for Muslims Gr1‚Äì12."
  },
  "subjects": {
    "grade9_minimum": "Minimum 9 subjects in Grade 9.",
    "gcse_compulsory": [
      "English Language (IGCSE)",
      "Religious/Islamic Studies",
      "Social Studies (only till Gr.9)",
      "Mathematics (IGCSE)",
      "Higher/Lower Arabic",
      "MEP(Arabic)/MEP(English); Arabic compulsory for Arabs till Gr.12"
    ],
    "gcse_optional": [
      "English Literature (IGCSE)",
      "ICT (IGCSE)",
      "Global Citizenship (IGCSE) or Urdu (GCSE)"
    ],
    "pairs": [
      "Chemistry or Accounts",
      "Physics or Economics",
      "Biology or Business Studies"
    ],
    "a_level": [
      "Math",
      "Physics or Economics",
      "Chemistry or Accounts",
      "Biology or Business Studies",
      "Islam (English or Arabic)",
      "Higher/Lower Arabic"
    ],
    "a_level_rules": [
      "Choose at least two A‚Äô Level subjects (excluding Arabic & Islamic).",
      "For UAE higher education: Arabic mandatory for all; Islamic mandatory for Muslims (MoE unified exams)."
    ]
  },
  "reports": {
    "collection": "A-Level / O-Level / AS-Level results are collected from the Principal‚Äôs office. Lower-grade report cards are given during PTM."
  },
  "facilities": {
    "transport": "School transport available on designated routes (subject to availability).",
    "uniform": "Uniform required. Purchase on campus at the bookstore near reception.",
    "canteen": "Canteen available on campus."
  },
  "portal": {
    "url": "https://uksmf.ppn.mograsys.com",
    "how": "Use the portal link. Get your username & password from the class teacher. If you forget your ID, contact the class teacher."
  },
  "policies": {
    "attendance": [
      "Be punctual and follow school timings.",
      "Absences require reason/medical note; report to school.",
      "Excessive absence may affect promotion/exam eligibility per MoE."
    ],
    "leave": "Submit a written leave letter to the class teacher.",
    "special_dress": "Event dependent; generally modest dress‚Äîbelow knee, no sleeveless (for boys and girls).",
    "bullying": "Zero tolerance‚Äîreport to class teacher/office immediately."
  }
}
  </script>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('form');
    const input = document.getElementById('q');
    const chips = document.getElementById('chips');
    const sys = document.getElementById('sys');
    const KB = document.getElementById('kb').textContent;

    function addBubble(text, me=false){
      const b=document.createElement('div');
      b.className='bubble ' + (me?'me':'bot');
      b.innerHTML=text.replace(/\n/g,'<br>');
      chat.appendChild(b); chat.scrollTop=chat.scrollHeight; return b;
    }
    let typingEl=null;
    function showTyping(){ typingEl=document.createElement('div'); typingEl.className='bubble bot';
      typingEl.innerHTML=`<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
      chat.appendChild(typingEl); chat.scrollTop=chat.scrollHeight; }
    function hideTyping(){ if(typingEl){typingEl.remove(); typingEl=null;} }

    // very light ‚Äúmemory‚Äù in localStorage
    const history = []; // {role, content}
    const profile = JSON.parse(localStorage.getItem("smchs_profile") || "{}");
    function rememberFrom(text){
      const g=text.match(/\bgrade\s*(\d{1,2})\b/i);
      if(g){profile.grade=g[1];localStorage.setItem("smchs_profile",JSON.stringify(profile));}
      const kg=text.match(/\bkg\s*([12])\b/i);
      if(kg){profile.grade=kg[1]==="1"?"KG1":"KG2";localStorage.setItem("smchs_profile",JSON.stringify(profile));}
    }

    async function ask(q){
      // small talk local responses to keep the bot lively
      const small = q.trim().toLowerCase();
      if(["hi","hello","hey","hey there","good morning","good afternoon","good evening"].includes(small)){
        addBubble(q,true); addBubble("Hello! üòä How can I help today‚Äîadmissions, fees, subjects, parent portal, or school timings?",false);
        return;
      }

      addBubble(q,true); rememberFrom(q); input.value=''; input.focus(); showTyping();
      const profileHint = profile.grade ? ` (student grade: ${profile.grade})` : '';

      try{
        const res = await fetch(WORKER_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ question:q+profileHint, kb:KB, history })
        });
        hideTyping();
        sys.textContent = '';
        if(!res.ok){
          addBubble("Sorry, I couldn‚Äôt reach the knowledge service just now. Try again in a moment.", false);
          return;
        }
        const data = await res.json();
        addBubble(data.answer || "I don‚Äôt have that in the official info. Please contact the school office at 09-2282828 or secretary.principal-smf@smgeducation.org.", false);
        if(data.followup) addBubble(`<i>${data.followup}</i>`, false);
        history.push({role:"user", content:q});
        history.push({role:"assistant", content:data.answer});
      }catch(e){
        hideTyping();
        sys.textContent = 'Network error ‚Äî check your Worker URL or CORS.';
        addBubble("Sorry, I couldn‚Äôt reach the knowledge service just now. Try again in a moment.", false);
      }
    }

    form.addEventListener('submit', e=>{e.preventDefault(); const q=input.value.trim(); if(q) ask(q);});
    chips.addEventListener('click', e=>{const btn=e.target.closest('[data-q]'); if(btn) ask(btn.dataset.q);});
    setTimeout(()=>input.focus(),250);
  </script>
</body>
</html>
