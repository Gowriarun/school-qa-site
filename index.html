<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>St. Mary‚Äôs Parent Assistant</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1222; --panel:#141833; --muted:#a9b1d6; --text:#e9edff;
      --bubble:#1b2250; --me:#2b377f; --accent:#6ea8ff; --border:rgba(255,255,255,.08);
      --ring:rgba(110,168,255,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 900px at 80% -10%, #1d2555 0%, #111432 45%, #0f1222 100%);
      font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{
      width:min(960px,100%); height:min(82vh,820px);
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.02)),var(--panel);
      border:1px solid var(--border); border-radius:20px; overflow:hidden;
      display:grid; grid-template-rows:auto 1fr auto;
      box-shadow:0 30px 80px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.04) inset;
    }
    header{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border);
      background:linear-gradient(180deg,rgba(255,255,255,.04),transparent)}
    .logo{height:28px;width:28px;border-radius:8px;background:linear-gradient(135deg,#6ea8ff,#a28bff);box-shadow:0 0 0 4px rgba(110,168,255,.12)}
    .brand{font-weight:600;letter-spacing:.3px}
    .sub{margin-left:auto;color:var(--muted);font-size:12px}

    .chat{position:relative;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth;background:
      radial-gradient(600px 260px at 10% -10%, rgba(110,168,255,.08), transparent 70%),
      radial-gradient(600px 260px at 110% 10%, rgba(162,139,255,.08), transparent 70%)}
    .bubble{max-width:min(78ch,86%);padding:12px 14px;border-radius:16px;line-height:1.55;font-size:15px;border:1px solid var(--border);
      background:var(--bubble);box-shadow:0 6px 24px rgba(0,0,0,.18)}
    .me{margin-left:auto;background:var(--me)}
    .bot{margin-right:auto}
    .hint{color:var(--muted);font-size:12px;margin-top:4px}
    .typing{display:inline-flex;gap:6px;align-items:center}
    .dot{width:6px;height:6px;border-radius:50%;background:#c9d5ff;opacity:.6;animation:blink 1.3s infinite}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    @keyframes blink{0%,80%,100%{opacity:.2}30%{opacity:.9}}

    .dock{padding:12px;border-top:1px solid var(--border);background:linear-gradient(0deg,rgba(255,255,255,.03),transparent);display:grid;gap:10px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:transparent;border:1px solid var(--border);color:var(--muted);padding:8px 10px;border-radius:999px;font-size:12px;cursor:pointer}
    .chip:hover{border-color:#8fb7ff33;color:#d9e4ff;box-shadow:0 0 0 4px var(--ring)}
    .form{display:flex;gap:10px}
    input[type="text"]{flex:1;padding:14px;border-radius:12px;border:1px solid var(--border);background:#0f1330;color:var(--text);outline:none;font-size:15px}
    input[type="text"]::placeholder{color:#9aa3cf}
    input[type="text"]:focus{box-shadow:0 0 0 4px var(--ring);border-color:#8fb7ff33}
    button.send{padding:0 16px;border-radius:12px;border:1px solid #7aa7ff55;color:#0d122e;background:linear-gradient(135deg,#6ea8ff,#a28bff);
      font-weight:700;display:inline-flex;align-items:center;gap:8px;cursor:pointer;box-shadow:0 10px 26px rgba(110,168,255,.35)}
    button.send:disabled{opacity:.5;cursor:not-allowed}
    @media (max-width:720px){.card{height:calc(100vh - 24px)}.bubble{max-width:92%}header{padding:12px}.chat{padding:14px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="St. Mary‚Äôs Parent Assistant">
      <header>
        <span class="logo" aria-hidden="true"></span>
        <div class="brand">St. Mary‚Äôs Parent Assistant</div>
        <div class="sub">Admissions ‚Ä¢ Fees ‚Ä¢ Subjects ‚Ä¢ Policies</div>
      </header>

      <main id="chat" class="chat" tabindex="0" aria-live="polite">
        <div class="bubble bot">
          Hi! I‚Äôm the St. Mary‚Äôs Parent Assistant üòä<br/>
          Ask me about <b>admissions</b>, <b>fees</b>, <b>subjects</b>, required documents, timings, or policies.
          <div class="hint">Try: ‚ÄúDocuments for admission‚Äù, ‚ÄúFees for Grade 11‚Äù, ‚ÄúA‚Äô Level subjects‚Äù, ‚ÄúSchool timings‚Äù.</div>
        </div>
      </main>

      <div class="dock">
        <div class="chips" id="chips">
          <button class="chip" data-q="What documents are required for admissions?">Documents</button>
          <button class="chip" data-q="Fees for Grade 11">Fees (G11)</button>
          <button class="chip" data-q="What are the school timings?">School timings</button>
          <button class="chip" data-q="Who is the principal?">Principal</button>
          <button class="chip" data-q="Where do I buy the uniform?">Uniform</button>
        </div>
        <form id="form" class="form" autocomplete="off">
          <input id="q" type="text" placeholder="Type your question‚Ä¶" required />
          <button id="send" class="send" type="submit" aria-label="Send">Send ‚Üó</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Set your Worker URL -->
  <script>
    const WORKER_URL = "https://delicate-cake-3610.gowriarunn2008.workers.dev/api/ask"; // ‚Üê replace
  </script>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('form');
    const input = document.getElementById('q');
    const chips = document.getElementById('chips');

    // pretty bubbles
    function addBubble(text, me=false){
      const b=document.createElement('div');
      b.className='bubble ' + (me?'me':'bot');
      b.innerHTML=text.replace(/\n/g,'<br>');
      chat.appendChild(b); chat.scrollTop=chat.scrollHeight; return b;
    }
    let typingEl=null;
    function showTyping(){ typingEl=document.createElement('div'); typingEl.className='bubble bot';
      typingEl.innerHTML=`<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
      chat.appendChild(typingEl); chat.scrollTop=chat.scrollHeight; }
    function hideTyping(){ if(typingEl){typingEl.remove(); typingEl=null;} }

    // small memory: last mentioned grade
    const profile = JSON.parse(localStorage.getItem("smchs_profile") || "{}");
    function rememberFrom(text){
      const g=text.match(/\bgrade\s*(\d{1,2})\b/i);
      if(g){profile.grade=g[1];localStorage.setItem("smchs_profile",JSON.stringify(profile));}
      const kg=text.match(/\bkg\s*([12])\b/i);
      if(kg){profile.grade=kg[1]==="1"?"KG1":"KG2";localStorage.setItem("smchs_profile",JSON.stringify(profile));}
    }

    // stable session id
    const SID_KEY="smf_parent_sid";
    let sessionId=localStorage.getItem(SID_KEY);
    if(!sessionId){ sessionId=crypto.randomUUID(); localStorage.setItem(SID_KEY, sessionId); }

    async function askUser(q){
      addBubble(q,true); rememberFrom(q); input.value=''; input.focus(); showTyping();

      // build message with a small hint about last grade (helps intent)
      const hint = profile.grade ? ` (last mentioned grade: ${profile.grade})` : '';
      const message = q + hint;

      try{
        const res = await fetch(WORKER_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message, sessionId })
        });
        hideTyping();
        if(!res.ok){
          addBubble("Sorry, I couldn‚Äôt reach the knowledge service just now. Try again in a moment."); 
          return;
        }
        const data = await res.json();
        addBubble(data.answer || "I don‚Äôt have that detail right now. Please contact the school office at 09-2282828.");
      }catch(e){
        hideTyping();
        addBubble("Network issue. Please try again in a moment.");
      }
    }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const q=input.value.trim();
      if(q) askUser(q);
    });
    chips.addEventListener('click', e=>{
      const btn=e.target.closest('[data-q]');
      if(btn) askUser(btn.dataset.q);
    });
    setTimeout(()=>input.focus(),200);
  </script>
</body>
</html>

